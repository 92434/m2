name: æ ‡è®°å·¥ä½œæµ - é•œåƒé‡æ ‡è®°

on:
  repository_dispatch:
    types: [tag-workflow]

jobs:
  tag-image:
    runs-on: ubuntu-latest
    
    steps:
      - name: åˆ›å»ºç›®æ ‡æ ‡ç­¾
        run: |
          SOURCE_IMAGE="${{ github.event.client_payload.source_image }}"
          TARGET_NAME="${{ github.event.client_payload.target_name }}"
          TARGET_BASE="ghcr.io/${{ github.repository_owner }}/$TARGET_NAME"
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          
          echo "ğŸ·ï¸ åˆ›å»ºæ ‡ç­¾:"
          echo "  æºé•œåƒ: $SOURCE_IMAGE"
          echo "  ç›®æ ‡åŸºç¡€: $TARGET_BASE"
          echo "  æ—¶é—´æˆ³: $TIMESTAMP"
          
          # æ ‡è®°ä¸ºlatest
          docker tag "$SOURCE_IMAGE" "${TARGET_BASE}:latest"
          
          # æ ‡è®°ä¸ºå¸¦æ—¶é—´æˆ³çš„ç‰ˆæœ¬
          docker tag "$SOURCE_IMAGE" "${TARGET_BASE}:${TIMESTAMP}"
          
      - name: éªŒè¯æ ‡ç­¾åˆ›å»º
        run: |
          TARGET_NAME="${{ github.event.client_payload.target_name }}"
          TARGET_BASE="ghcr.io/${{ github.repository_owner }}/$TARGET_NAME"
          docker images "$TARGET_BASE" --format "table {{.Repository}}\t{{.Tag}}\t{{.ID}}"