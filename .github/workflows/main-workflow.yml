name: 主工作流 - 镜像传输协调器

on:
  workflow_dispatch:
    inputs:
      source_image:
        description: '源镜像地址'
        required: false
        default: 'jiangrui1994/cloudsaver:latest'
      target_name:
        description: '目标包名称'
        required: false
        default: 'cloudsaver'

jobs:
  coordinator:
    runs-on: ubuntu-latest
    steps:
      - name: 检查输入参数
        run: |
          echo "源镜像: ${{ github.event.inputs.source_image }}"
          echo "目标名称: ${{ github.event.inputs.target_name }}"
          echo "触发者: ${{ github.actor }}"
      
      - name: 触发认证工作流
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          event-type: auth-workflow
          client-payload: '{"source_image": "${{ github.event.inputs.source_image }}", "target_name": "${{ github.event.inputs.target_name }}"}'