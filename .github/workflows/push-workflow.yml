name: æ¨é€å·¥ä½œæµ - é•œåƒå‘å¸ƒ

on:
  repository_dispatch:
    types: [push-workflow]

jobs:
  push-image:
    runs-on: ubuntu-latest
    permissions:
      packages: write
    
    steps:
      - name: Dockerè®¤è¯
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: æ¨é€é•œåƒåˆ°GitHub Packages
        run: |
          TARGET_NAME="${{ github.event.client_payload.target_name }}"
          TARGET_BASE="ghcr.io/${{ github.repository_owner }}/$TARGET_NAME"
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          
          echo "ğŸš€ æ­£åœ¨æ¨é€é•œåƒåˆ°GitHub Packages..."
          echo "ç›®æ ‡åœ°å€: $TARGET_BASE"
          
          # æ¨é€latestæ ‡ç­¾
          docker push "${TARGET_BASE}:latest"
          
          # æ¨é€æ—¶é—´æˆ³æ ‡ç­¾
          docker push "${TARGET_BASE}:${TIMESTAMP}"
          
      - name: è¾“å‡ºæˆåŠŸä¿¡æ¯
        run: |
          TARGET_NAME="${{ github.event.client_payload.target_name }}"
          echo "âœ… é•œåƒæ¨é€æˆåŠŸ!"
          echo "ğŸ”— åŒ…åœ°å€: https://github.com/${{ github.repository_owner }}?tab=packages&repo_name=$TARGET_NAME"
          echo "ğŸ“¦ å¯ç”¨æ ‡ç­¾:"
          echo "  - latest"
          echo "  - $(date +%Y%m%d-%H%M%S)"