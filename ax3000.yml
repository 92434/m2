name: Official Debug Session
on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'è°ƒè¯•ä¼šè¯æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰'
        required: false
        default: '15'
      mode:
        description: 'è°ƒè¯•æ¨¡å¼'
        required: false
        default: 'interactive'
        type: choice
        options:
          - 'interactive'
          - 'detached'
      setup_commands:
        description: 'è°ƒè¯•å‰æ‰§è¡Œçš„åˆå§‹åŒ–å‘½ä»¤'
        required: false
        default: ''

jobs:
  debug:
    name: ğŸ› Official tmate Debug Session
    runs-on: ubuntu-latest
    timeout-minutes: ${{ fromJSON(github.event.inputs.duration) + 10 }}

    steps:
      - name: â±ï¸ Set timezone
        run: sudo timedatectl set-timezone "Asia/Shanghai"

      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Pre-debug Setup
        if: github.event.inputs.setup_commands != ''
        run: |
          echo "ğŸ“‹ Executing pre-debug setup commands..."
          ${{ github.event.inputs.setup_commands }}

      - name: Setup Official Debug Session
        uses: mxschmitt/action-tmate@v3
        timeout-minutes: ${{ fromJSON(github.event.inputs.duration) }}
        with:
          detached: ${{ github.event.inputs.mode == 'detached' }}
          limit-access-to-actor: true

      - name: ğŸ“Š Session Summary
        if: always()
        run: |
          echo "===================================="
          echo "ğŸ› DEBUG SESSION COMPLETED"
          echo "===================================="
          echo "Status: ${{ job.status }}"
          echo "Duration: ${{ github.event.inputs.duration }} minutes"
          echo "Mode: ${{ github.event.inputs.mode }}"
          echo "Runner: ${{ runner.name }}"
          echo "===================================="
